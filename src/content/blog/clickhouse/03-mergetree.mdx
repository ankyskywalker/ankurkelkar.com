---
title: "Part 3: The MergeTree Family"
date: 2023-10-03
description: "Understanding the core engine of ClickHouse: MergeTree, Sorting, and Partitioning."
tags: ["ClickHouse", "MergeTree", "Engines"]
part: "Part 3 of 10"
cover: "../../../assets/images/clickhouse/part-3.png"
---

<p class="lead text-xl text-gray-300 mb-8">
    If ClickHouse is a race car, the MergeTree engine is its V12 engine.
    It's the default and most versatile table engine in ClickHouse.
</p>

<h2>What is MergeTree?</h2>
<p>
    The <code>MergeTree</code> family of engines is designed for inserting
    very large amounts of data into a table. The data is quickly written
    to the table part by part, and then rules are applied for merging these
    parts in the background.
</p>

<h2>Key Concepts</h2>
<div class="grid grid-cols-1 md:grid-cols-2 gap-6 my-8">
    <div class="bg-slate-800/50 p-6 rounded-lg border-l-4 border-blue-500">
        <h4 class="text-blue-300 font-bold mb-2">Primary Key</h4>
        <p>
            Unlike other DBs, the primary key in ClickHouse is not
            unique. It's used for sorting data and index granularity.
        </p>
    </div>
    <div class="bg-slate-800/50 p-6 rounded-lg border-l-4 border-purple-500">
        <h4 class="text-purple-300 font-bold mb-2">Partitioning</h4>
        <p>
            Partitioning splits your data into logical blocks (e.g., by
            month) to optimize queries and data management.
        </p>
    </div>
</div>

<h2>Creating a Table</h2>
<pre class="language-sql">
CREATE TABLE hits (
    timestamp DateTime,
    user_id UInt64,
    url String,
    event_type Enum('view' = 1, 'click' = 2)
) ENGINE = MergeTree()
PARTITION BY toYYYYMM(timestamp)
ORDER BY (timestamp, user_id);
</pre>

<h2>How Merges Work</h2>
<p>
    When you insert data, ClickHouse creates a new "part" on disk. In
    the background, ClickHouse merges these parts together to keep the
    number of files manageable and data sorted.
</p>

<h2>Conclusion</h2>
<p>
    Understanding MergeTree is crucial for mastering ClickHouse. In the
    next part, we'll look at how to model your data effectively.
</p>

<div class="flex justify-between mt-12 pt-8 border-t border-gray-700">
    <a href="/blog/clickhouse/02-installation" class="text-pink-400 hover:text-pink-300 font-bold">&larr; Part 2 - Installation</a>
    <a href="/blog/clickhouse/04-modeling" class="text-pink-400 hover:text-pink-300 font-bold">Next: Part 4 - Data Modeling &rarr;</a>
</div>
